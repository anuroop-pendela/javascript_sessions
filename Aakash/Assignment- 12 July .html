<html>
  <title>Bullet Chart</title>
  <head>Bullet Chart</head>
  <body
    <br>     </br>
    <label style="background-color:  red">Target</label>
    <label style="background-color:  yellow">Current</label>
    <label style="background-color:  silver">Last Week</label>
    <label style="background-color:  grey">Last Month</label>
    <div id="add_svg"></div>

  </body>
</html>

<script src="https://d3js.org/d3.v5.min.js"></script>


<style>
  #add_svg
  {
    width: 1280;
    height: 600;
  }
  .bars1
  {
    fill: grey;
  }
  .bars2{
    fill: silver;
  }
  .bars3{
    fill: yellow;
  }
  .bars4{
    fill: red;
  }
  .bars
  {
    fill: gainsboro;
  }
</style>

<script>

var data=[
{ "region":"A", "value":{"last_week":"250","last_month":"150","current": "270","target":"280"}},
{ "region":"B", "value":{"last_week":"210","last_month":"180","current": "230","target":"270"}},
{ "region":"C", "value":{"last_week":"250","last_month":"200","current": "300","target":"290"}},
{ "region":"D", "value":{"last_week":"250","last_month":"220","current": "280","target":"340"}},
{ "region":"E", "value":{"last_week":"270","last_month":"200","current": "295","target":"310"}}
]

//  console.log(data[0].value.last_week);
  var svg= d3.select("#add_svg").append("svg").attr("width",1280).attr("height",600);

//  console.log(data[0].value.last_we)
  var max_x=0;

  var max_y= d3.max(data,function(d)
  {
    max_x++;
    var max=d.value.last_week;
    if(max<d.value.last_month)
    max=d.value.last_month;
    if(max<d.value.current)
    max=d.value.current;
    if(max<d.value.target)
    return d.value.target;
    else {
      return max;
    }
  });

  //console.log(max_y," ",max_x);
  margin = {
      top: 20,
      right: 20,
      bottom: 30,
      left: 40
    },
  width = 1280 - margin.left - margin.right;
  height= 600 - margin.top - margin.bottom;
;
  gap=10;

  var x= d3.scaleBand().rangeRound([0,width]).padding(.2);
  x.domain(data.map(function(d) {
    return (d.region);
  }));
//  x.domain([0,]);



//  console.log("bandwidth "+x.bandwidth());

  var y=d3.scaleLinear().range([height,0]);
  y.domain([0,max_y]);


  var g = svg.append("g")
    .attr("transform", "translate(" + margin.left+ "," + margin.top +")");


    g.append("g")
        .attr("class", "axis--y")
        .call(d3.axisLeft(y))



        g.selectAll(".bars")
        .data(data)
        .enter()
        .append("rect")
        .attr("class","bars")
        .attr("x",function(d,i)
          {

            return x(d.region);
          })
        .attr("y",function(d)
          {
              return margin.top;
          })
        .attr("width",x.bandwidth())
        .attr("height",height-margin.bottom);

        g.selectAll(".bars2")
        .data(data)
        .enter()
        .append("rect")
        .attr("class","bars2")
        .attr("x",function(d,i)
          {
        //    console.log(x(d.region));
            return x(d.region);
          })
        .attr("y",function(d)
          {
          //    console.log(height-d.value.last_week);
              return height-d.value.last_week;
          })
        .attr("width",x.bandwidth())
        .attr("height",function(d)
            {
              return d.value.last_week;
            })


  g.selectAll(".bars1")
  .data(data)
  .enter()
  .append("rect")
  .attr("class","bars1")
  .attr("x",function(d,i)
    {

      return x(d.region);
    })
  .attr("y",function(d)
    {
        return height-d.value.last_month;
    })
  .attr("width",x.bandwidth())
  .attr("height",function(d)
      {
        return d.value.last_month;
      })



  g.selectAll("bars4")
  .data(data)
  .enter()
  .append("rect")
  .attr("class","bars4")
  .attr("x",function(d,i)
    {
//      console.log(x(d.region));
      return x(d.region)+50;
    })
  .attr("y",function(d)
    {
//        console.log(height-d.value.last_month);
        return height-d.value.target;
    })
  .attr("width",x.bandwidth()-100)
  .attr("height",function(d)
      {
        return 10;
      })


          g.selectAll("bars3")
          .data(data)
          .enter()
          .append("rect")
          .attr("class","bars3")
          .attr("x",function(d)
            {
              return x(d.region)+x.bandwidth()/2-15;
            })
          .attr("y",function(d)
            {
              return height-d.value.current;
            })
          .attr("width",30)
          .attr("height",function(d)
              {
                return d.value.current;
              })


</script>
